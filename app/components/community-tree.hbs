<section id="visualization" class="bg-white w-3/4 hidden md:block"
  {{on-resize this.calculateSizes}}
>
  <svg 
    class="community-tree" 
    width={{this.svgWidth}} height={{this.svgHeight}}
    {{on-key "ArrowRight" (fn this.selectPerson "forward")}}
    {{on-key "ArrowLeft" (fn this.selectPerson "backward")}}
    {{did-insert this.calculateSizes}}
    {{did-update this.calculateSizes}}
    >
    <defs>
      <radialGradient id="community-tree-inner-gradient" cx="50%" cy="50%" r="50%" fx="50%" fy="50%">
        <stop 
          offset="{{mult 0.9 this.gradient1817}}%" 
          style="stop-color:rgb(255,255,255); stop-opacity:1" />
        <stop 
        offset="{{this.gradient1817}}%"
          style="stop-color:rgb(255,255,255); stop-opacity:0.5" />
        <stop 
        offset="{{mult 1.09 this.gradient1817}}%" 
         style="stop-color:rgb(255,255,255); stop-opacity:0" />
      </radialGradient>
      <radialGradient id="community-tree-outer-gradient" cx="50%" cy="50%" r="50%" fx="50%" fy="50%">
        <stop 
          offset="{{mult 0.95 this.gradient1832}}%" 
          style="stop-color:rgb(255,255,255); stop-opacity:0" />
        <stop 
        offset="{{this.gradient1832}}%"
          style="stop-color:rgb(255,255,255); stop-opacity:0.5" />
        <stop 
        offset="{{mult 1.04 this.gradient1832}}%" 
         style="stop-color:rgb(255,255,255); stop-opacity:1" />
      </radialGradient>
      {{#each @data as |person|}}
        <CommunityTree::PersonGradient @person={{person}} />
      {{/each}}
    </defs>
    <g 
      transform="translate({{add this.margins.left this.circleRadius}},{{add this.margins.top this.circleRadius}})">
      {{#each @data as |person i|}}
      <CommunityTree::Person 
        @person={{person}}
        @i={{i}} 
        @dataLength={{this.dataLength}}
        @yearScale={{this.yearScale}}
        @colorScale={{this.colorScale}}
        @minYear={{this.minYear}}
      />
      {{/each}}
      </g>
      <g transform="translate({{add 200 (div this.svgWidth 2)}},{{sub this.svgHeight 50}})">
        <CommunityTree::AgeScaleBar @colorScale={{this.colorScale}}/>
      </g>
      <rect x={{this.margins.left}} y={{this.margins.top}}
        width={{sub this.svgWidth (add this.margins.left this.margins.right) }}
        height={{sub this.svgHeight (add this.margins.top this.margins.bottom) }}
        fill="none"
        stroke="red"
        stroke-width="3"
        />
      <ellipse cx="0" cy="0" 
        class="pointer-events-none"
        rx={{this.circleRadius}} 
        ry={{this.circleRadius}} 
        fill="url(#community-tree-inner-gradient)" 
        transform="translate({{add this.margins.left this.circleRadius}},{{add this.margins.top this.circleRadius}})"/>
      <ellipse cx="0" cy="0" 
        class="pointer-events-none"
        rx={{this.circleRadius}} 
        ry={{this.circleRadius}} 
        fill="url(#community-tree-outer-gradient)" 
        transform="translate({{add this.margins.left this.circleRadius}},{{add this.margins.top this.circleRadius}})"/>
      <g transform="translate({{add this.margins.left this.circleRadius}},
      {{add this.margins.top this.circleRadius}})">
        <CommunityTree::YearScale
          @yearScale={{this.yearScale}} 
          @width={{this.circleRadius}}
          />
      </g>
  </svg>
</section>
